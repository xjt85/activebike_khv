{% extends 'index.html' %}
{% load static %}
{% load cache %}
{% load thumbnail %}
{% block title %}Отчеты - {% endblock %}

{% block content %}

<section class="content-section content-section_pt0">
  {% comment %} <h2 class="content-section__title content-section__title_nearest">Отчеты</h2> {% endcomment %}
{% if reports %}
  {% for report in reports %}
    <article class="article">
      <h3 class="article-title"><a href="{% url 'events:report_detail' report.id %}" class="article-title__link">{{ report.title }}</a></h3>
      {% if user.is_authenticated and request.user == report.author %}
        <a class="article__edit-button" href="{% url 'admin:index' %}events/report/{{ report.id }}/change/"><i class="fa fa-pencil" aria-hidden="true"></i></a>
      {% endif %}
      <div class="article__main">
        <div class="article__left">
          <a href="{% url 'events:report_detail' report.id %}" class="article__image">
            {% thumbnail report.image "300x300" crop="center" upscale=True as im %}
              <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="{{ report.title }}" class="article__image-img">
            {% endthumbnail %}
          </a>
        </div>
        <div class="article__right">
          <div class="article-descr">
            <p class="article-descr__text">{{ report.text_html|safe|truncatechars_html:300 }}</p>
            <a href="{% url 'events:report_detail' report.id %}" class="article__more">Читать дальше →</a>
          </div>
        </div>
      </div>
      <div class="article-info">
        <div class="article-info__views"><i class="fa fa-eye" aria-hidden="true"> </i>{{ report.total_views }}
          {% if report.last_views %}
            <span class="article-info__lastviews">
              +{{ report.last_views }}
            </span>
          {% endif %}
        </div>
        <div class="article-info__comments"><i class="fa fa-comment-o" aria-hidden="true"></i>  0</div>
        <div class="article-info__author">{{ report.author|truncatechars:9 }}</div>
        <div class="article-info__edit"><i class="fa fa-pencil" aria-hidden="true"></i> {{ report.date_edit|date:"d.m.Y" }}</div>
      </div>
    </article>
  {% endfor %}
{% else %}
  <article class="article">
    Нет отчетов.
  </article>
{% endif %}
</section>
{% endblock %}
