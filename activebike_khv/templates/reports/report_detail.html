{% extends 'index.html' %}
{% load static %}
{% load cache %}
{% load thumbnail %}
{% block title %}{{ report.title }} - {% endblock %}

{% block content %}
<section class="content-section">
  <div class="backlink-wrapper">
    <a href="{% url 'events:reports_index' %}" class="backlink">Назад к списку</a>
  </div>
  <article class="article article_page">
    <h2 class="article-title article-title_page">{{ report.title }}</h2>
    {% if user.is_authenticated and request.user == report.author %}
      <a class="article__edit-button article__edit-button_page" href="{% url 'admin:index' %}events/report/{{ report.id }}/change/"><i class="fa fa-pencil" aria-hidden="true"></i></a>
    {% endif %}
    <div class="article__main article__main_page">
      
      {% if report.image %}
        <div class="article__image article__image_page">
          {% thumbnail report.image "700x400" upscale=True as im %}
            <img src="{{ im.url }}" alt="{{ report.title }}" class="article__image-img article__image-img_page">
          {% endthumbnail %}
        </div>
      {% endif %}
      
      <div class="article-descr article-descr_page">
        <p class="article-descr__text article-descr__text_page">{{ report.text_html|safe }}</p>
      </div>

      <div class="report-backevent-wrapper">
        {% if report.report_event %}
            <a href="{% url 'events:event_detail' report.report_event.id %}" class="article__more">← Назад к событию</a>
        {% endif %}
      </div>

      <div class="report-gallery owl-carousel owl-theme">
        {% for images in gallery %}
        <div class="report-gallery__item">
          <a data-fancybox="gallery" href="{{ images.image.url }}" class="route-gallery__link">
            {% thumbnail images.image "300x300" crop="center" upscale=True as im %}
              <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="{{ route.title }}" class="route-gallery__img">
            {% endthumbnail %}
          </a>
        </div>
        {% endfor %}
      </div>

    </div>

    <div class="article-info article-info_page">
      <div class="article-info__views"><i class="fa fa-eye" aria-hidden="true"> </i>{{ report.total_views }}
        {% if report.last_views %}
          <span class="article-info__lastviews">
            +{{ report.last_views }}
          </span>
        {% endif %}
      </div>
      <div class="article-info__comments"><i class="fa fa-comment-o" aria-hidden="true"></i>  0</div>
      <div class="article-info__author">{{ report.author|truncatechars:9 }}</div>
      <div class="article-info__edit"><i class="fa fa-pencil" aria-hidden="true"></i> {{ report.date_edit|date:"d.m.Y" }}</div>
    </div>
  </article>
</section>
<script>
  $(document).ready(function(){
    //примечание
    $(".owl-carousel").owlCarousel({
      loop:true,
      margin:3,
      dots:false,
      nav:false,
      responsive:{
        0:{
            items:1,
            loop:true,
            stagePadding: 20
          },
          600:{
            items:2,
            loop:false
          },
          1000:{
            items:3,
            loop:false
        }
      }
    });
  });
</script>    
{% endblock %}
